<!DOCTYPE html>
<html>
<head>
    <title>高级波形查看器 - simple_mac_test.vcd</title>
    <meta charset="UTF-8">
    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 300px;
            background: #2c3e50;
            color: white;
            overflow-y: auto;
            padding: 20px;
        }
        
        .main-content {
            flex: 1;
            background: white;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .toolbar {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .waveform-area {
            flex: 1;
            overflow: auto;
            padding: 20px;
        }
        
        .signal-item {
            background: #34495e;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .signal-item:hover {
            background: #4a6741;
            transform: translateX(5px);
        }
        
        .signal-item.selected {
            background: #27ae60;
        }
        
        .signal-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .signal-info {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .signal-stats {
            margin-top: 10px;
            font-size: 11px;
        }
        
        .waveform-canvas {
            border: 1px solid #dee2e6;
            margin: 10px 0;
            background: white;
            cursor: crosshair;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover { background: #0056b3; }
        .btn.secondary { background: #6c757d; }
        .btn.success { background: #28a745; }
        .btn.danger { background: #dc3545; }
        
        .input-field {
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .measurement-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            display: none;
            z-index: 1000;
        }
        
        .analysis-panel {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .search-box {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #495057;
            border-radius: 4px;
            background: #495057;
            color: white;
        }
        
        .search-box::placeholder {
            color: #adb5bd;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <h2>🌊 信号列表</h2>
            
            <input type="text" class="search-box" id="signalSearch" placeholder="搜索信号...">
            
            <div class="analysis-panel">
                <h4>📊 统计信息</h4>
                <div>总信号数: 8</div>
                <div>总跳变数: 88</div>
                <div>仿真时间: 315,000 ps</div>
            </div>
            
            <div id="signalList"></div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1>🔬 高级RTL波形分析器</h1>
                <p>simple_mac_test.vcd | 分析时间: 2025-08-31 00:23:45</p>
            </div>
            
            <div class="toolbar">
                <div class="controls">
                    <div class="control-group">
                        <label>时间:</label>
                        <input type="number" class="input-field" id="timeStart" value="0" style="width: 100px;">
                        <span>-</span>
                        <input type="number" class="input-field" id="timeEnd" value="315000" style="width: 100px;">
                        <span>ps</span>
                    </div>
                    
                    <div class="control-group">
                        <label>缩放:</label>
                        <input type="range" id="zoomSlider" min="0.1" max="20" value="1" step="0.1" style="width: 150px;">
                        <span id="zoomValue">1.0x</span>
                    </div>
                    
                    <button class="btn" onclick="resetView()">重置</button>
                    <button class="btn secondary" onclick="fitToWindow()">适应窗口</button>
                    <button class="btn success" onclick="measureMode()">测量模式</button>
                    <button class="btn danger" onclick="exportData()">导出数据</button>
                </div>
            </div>
            
            <div class="waveform-area">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="selectedSignals">0</div>
                        <div class="stat-label">选中信号</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="visibleTime">0</div>
                        <div class="stat-label">可见时间 (ps)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="cursorTime">-</div>
                        <div class="stat-label">光标时间 (ps)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="measurementDelta">-</div>
                        <div class="stat-label">测量间隔 (ps)</div>
                    </div>
                </div>
                
                <canvas id="mainCanvas" class="waveform-canvas" width="1200" height="600"></canvas>
            </div>
        </div>
    </div>
    
    <div class="measurement-panel" id="measurementPanel">
        <div id="measurementInfo"></div>
    </div>
    
    <script>
        // 全局数据和状态
        const waveformData = [
  {
    "id": "!",
    "name": "a",
    "type": "reg",
    "width": 16,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "0"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "0"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "0"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "0"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "0"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "0"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "0"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "0"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "0"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "0"
      },
      {
        "time": 105000,
        "value": "0"
      },
      {
        "time": 110000,
        "value": "0"
      },
      {
        "time": 115000,
        "value": "0"
      },
      {
        "time": 120000,
        "value": "10"
      },
      {
        "time": 125000,
        "value": "10"
      },
      {
        "time": 130000,
        "value": "10"
      },
      {
        "time": 135000,
        "value": "10"
      },
      {
        "time": 140000,
        "value": "10"
      },
      {
        "time": 145000,
        "value": "10"
      },
      {
        "time": 150000,
        "value": "10"
      },
      {
        "time": 155000,
        "value": "10"
      },
      {
        "time": 160000,
        "value": "101"
      },
      {
        "time": 165000,
        "value": "101"
      },
      {
        "time": 170000,
        "value": "101"
      },
      {
        "time": 175000,
        "value": "101"
      },
      {
        "time": 180000,
        "value": "101"
      },
      {
        "time": 185000,
        "value": "101"
      },
      {
        "time": 190000,
        "value": "101"
      },
      {
        "time": 195000,
        "value": "101"
      },
      {
        "time": 200000,
        "value": "0"
      },
      {
        "time": 205000,
        "value": "0"
      },
      {
        "time": 210000,
        "value": "0"
      },
      {
        "time": 215000,
        "value": "0"
      },
      {
        "time": 220000,
        "value": "0"
      },
      {
        "time": 225000,
        "value": "0"
      },
      {
        "time": 230000,
        "value": "0"
      },
      {
        "time": 235000,
        "value": "0"
      },
      {
        "time": 240000,
        "value": "0"
      },
      {
        "time": 245000,
        "value": "0"
      },
      {
        "time": 250000,
        "value": "0"
      },
      {
        "time": 255000,
        "value": "0"
      },
      {
        "time": 260000,
        "value": "0"
      },
      {
        "time": 265000,
        "value": "0"
      },
      {
        "time": 270000,
        "value": "0"
      },
      {
        "time": 275000,
        "value": "0"
      },
      {
        "time": 280000,
        "value": "0"
      },
      {
        "time": 285000,
        "value": "0"
      },
      {
        "time": 290000,
        "value": "0"
      },
      {
        "time": 295000,
        "value": "0"
      },
      {
        "time": 300000,
        "value": "0"
      },
      {
        "time": 305000,
        "value": "0"
      },
      {
        "time": 310000,
        "value": "0"
      },
      {
        "time": 315000,
        "value": "0"
      }
    ],
    "transitions": 3,
    "frequency": 0,
    "duty_cycle": 0,
    "high_time": 0,
    "low_time": 0
  },
  {
    "id": "\"",
    "name": "b",
    "type": "reg",
    "width": 16,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "0"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "0"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "0"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "0"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "0"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "0"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "0"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "0"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "0"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "0"
      },
      {
        "time": 105000,
        "value": "0"
      },
      {
        "time": 110000,
        "value": "0"
      },
      {
        "time": 115000,
        "value": "0"
      },
      {
        "time": 120000,
        "value": "11"
      },
      {
        "time": 125000,
        "value": "11"
      },
      {
        "time": 130000,
        "value": "11"
      },
      {
        "time": 135000,
        "value": "11"
      },
      {
        "time": 140000,
        "value": "11"
      },
      {
        "time": 145000,
        "value": "11"
      },
      {
        "time": 150000,
        "value": "11"
      },
      {
        "time": 155000,
        "value": "11"
      },
      {
        "time": 160000,
        "value": "111"
      },
      {
        "time": 165000,
        "value": "111"
      },
      {
        "time": 170000,
        "value": "111"
      },
      {
        "time": 175000,
        "value": "111"
      },
      {
        "time": 180000,
        "value": "111"
      },
      {
        "time": 185000,
        "value": "111"
      },
      {
        "time": 190000,
        "value": "111"
      },
      {
        "time": 195000,
        "value": "111"
      },
      {
        "time": 200000,
        "value": "1100100"
      },
      {
        "time": 205000,
        "value": "1100100"
      },
      {
        "time": 210000,
        "value": "1100100"
      },
      {
        "time": 215000,
        "value": "1100100"
      },
      {
        "time": 220000,
        "value": "1100100"
      },
      {
        "time": 225000,
        "value": "1100100"
      },
      {
        "time": 230000,
        "value": "1100100"
      },
      {
        "time": 235000,
        "value": "1100100"
      },
      {
        "time": 240000,
        "value": "1100100"
      },
      {
        "time": 245000,
        "value": "1100100"
      },
      {
        "time": 250000,
        "value": "1100100"
      },
      {
        "time": 255000,
        "value": "1100100"
      },
      {
        "time": 260000,
        "value": "1100100"
      },
      {
        "time": 265000,
        "value": "1100100"
      },
      {
        "time": 270000,
        "value": "1100100"
      },
      {
        "time": 275000,
        "value": "1100100"
      },
      {
        "time": 280000,
        "value": "1100100"
      },
      {
        "time": 285000,
        "value": "1100100"
      },
      {
        "time": 290000,
        "value": "1100100"
      },
      {
        "time": 295000,
        "value": "1100100"
      },
      {
        "time": 300000,
        "value": "1100100"
      },
      {
        "time": 305000,
        "value": "1100100"
      },
      {
        "time": 310000,
        "value": "1100100"
      },
      {
        "time": 315000,
        "value": "1100100"
      }
    ],
    "transitions": 3,
    "frequency": 0,
    "duty_cycle": 0,
    "high_time": 0,
    "low_time": 0
  },
  {
    "id": "#",
    "name": "c",
    "type": "reg",
    "width": 32,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "0"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "0"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "0"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "0"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "0"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "0"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "0"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "0"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "0"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "0"
      },
      {
        "time": 105000,
        "value": "0"
      },
      {
        "time": 110000,
        "value": "0"
      },
      {
        "time": 115000,
        "value": "0"
      },
      {
        "time": 120000,
        "value": "100"
      },
      {
        "time": 125000,
        "value": "100"
      },
      {
        "time": 130000,
        "value": "100"
      },
      {
        "time": 135000,
        "value": "100"
      },
      {
        "time": 140000,
        "value": "100"
      },
      {
        "time": 145000,
        "value": "100"
      },
      {
        "time": 150000,
        "value": "100"
      },
      {
        "time": 155000,
        "value": "100"
      },
      {
        "time": 160000,
        "value": "1"
      },
      {
        "time": 165000,
        "value": "1"
      },
      {
        "time": 170000,
        "value": "1"
      },
      {
        "time": 175000,
        "value": "1"
      },
      {
        "time": 180000,
        "value": "1"
      },
      {
        "time": 185000,
        "value": "1"
      },
      {
        "time": 190000,
        "value": "1"
      },
      {
        "time": 195000,
        "value": "1"
      },
      {
        "time": 200000,
        "value": "110010"
      },
      {
        "time": 205000,
        "value": "110010"
      },
      {
        "time": 210000,
        "value": "110010"
      },
      {
        "time": 215000,
        "value": "110010"
      },
      {
        "time": 220000,
        "value": "110010"
      },
      {
        "time": 225000,
        "value": "110010"
      },
      {
        "time": 230000,
        "value": "110010"
      },
      {
        "time": 235000,
        "value": "110010"
      },
      {
        "time": 240000,
        "value": "110010"
      },
      {
        "time": 245000,
        "value": "110010"
      },
      {
        "time": 250000,
        "value": "110010"
      },
      {
        "time": 255000,
        "value": "110010"
      },
      {
        "time": 260000,
        "value": "110010"
      },
      {
        "time": 265000,
        "value": "110010"
      },
      {
        "time": 270000,
        "value": "110010"
      },
      {
        "time": 275000,
        "value": "110010"
      },
      {
        "time": 280000,
        "value": "110010"
      },
      {
        "time": 285000,
        "value": "110010"
      },
      {
        "time": 290000,
        "value": "110010"
      },
      {
        "time": 295000,
        "value": "110010"
      },
      {
        "time": 300000,
        "value": "110010"
      },
      {
        "time": 305000,
        "value": "110010"
      },
      {
        "time": 310000,
        "value": "110010"
      },
      {
        "time": 315000,
        "value": "110010"
      }
    ],
    "transitions": 3,
    "frequency": 0,
    "duty_cycle": 0,
    "high_time": 0,
    "low_time": 0
  },
  {
    "id": "$",
    "name": "clk",
    "type": "reg",
    "width": 1,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "1"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "1"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "1"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "1"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "1"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "1"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "1"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "1"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "1"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "1"
      },
      {
        "time": 105000,
        "value": "0"
      },
      {
        "time": 110000,
        "value": "1"
      },
      {
        "time": 115000,
        "value": "0"
      },
      {
        "time": 120000,
        "value": "1"
      },
      {
        "time": 125000,
        "value": "0"
      },
      {
        "time": 130000,
        "value": "1"
      },
      {
        "time": 135000,
        "value": "0"
      },
      {
        "time": 140000,
        "value": "1"
      },
      {
        "time": 145000,
        "value": "0"
      },
      {
        "time": 150000,
        "value": "1"
      },
      {
        "time": 155000,
        "value": "0"
      },
      {
        "time": 160000,
        "value": "1"
      },
      {
        "time": 165000,
        "value": "0"
      },
      {
        "time": 170000,
        "value": "1"
      },
      {
        "time": 175000,
        "value": "0"
      },
      {
        "time": 180000,
        "value": "1"
      },
      {
        "time": 185000,
        "value": "0"
      },
      {
        "time": 190000,
        "value": "1"
      },
      {
        "time": 195000,
        "value": "0"
      },
      {
        "time": 200000,
        "value": "1"
      },
      {
        "time": 205000,
        "value": "0"
      },
      {
        "time": 210000,
        "value": "1"
      },
      {
        "time": 215000,
        "value": "0"
      },
      {
        "time": 220000,
        "value": "1"
      },
      {
        "time": 225000,
        "value": "0"
      },
      {
        "time": 230000,
        "value": "1"
      },
      {
        "time": 235000,
        "value": "0"
      },
      {
        "time": 240000,
        "value": "1"
      },
      {
        "time": 245000,
        "value": "0"
      },
      {
        "time": 250000,
        "value": "1"
      },
      {
        "time": 255000,
        "value": "0"
      },
      {
        "time": 260000,
        "value": "1"
      },
      {
        "time": 265000,
        "value": "0"
      },
      {
        "time": 270000,
        "value": "1"
      },
      {
        "time": 275000,
        "value": "0"
      },
      {
        "time": 280000,
        "value": "1"
      },
      {
        "time": 285000,
        "value": "0"
      },
      {
        "time": 290000,
        "value": "1"
      },
      {
        "time": 295000,
        "value": "0"
      },
      {
        "time": 300000,
        "value": "1"
      },
      {
        "time": 305000,
        "value": "0"
      },
      {
        "time": 310000,
        "value": "1"
      },
      {
        "time": 315000,
        "value": "0"
      }
    ],
    "transitions": 63,
    "frequency": 100000000.0,
    "duty_cycle": 49.2063492063492,
    "high_time": 155000,
    "low_time": 160000
  },
  {
    "id": "%",
    "name": "ready",
    "type": "reg",
    "width": 1,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "0"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "0"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "0"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "0"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "0"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "0"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "0"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "0"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "0"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "0"
      },
      {
        "time": 105000,
        "value": "0"
      },
      {
        "time": 110000,
        "value": "0"
      },
      {
        "time": 115000,
        "value": "0"
      },
      {
        "time": 120000,
        "value": "0"
      },
      {
        "time": 125000,
        "value": "0"
      },
      {
        "time": 130000,
        "value": "1"
      },
      {
        "time": 135000,
        "value": "1"
      },
      {
        "time": 140000,
        "value": "0"
      },
      {
        "time": 145000,
        "value": "0"
      },
      {
        "time": 150000,
        "value": "0"
      },
      {
        "time": 155000,
        "value": "0"
      },
      {
        "time": 160000,
        "value": "0"
      },
      {
        "time": 165000,
        "value": "0"
      },
      {
        "time": 170000,
        "value": "1"
      },
      {
        "time": 175000,
        "value": "1"
      },
      {
        "time": 180000,
        "value": "0"
      },
      {
        "time": 185000,
        "value": "0"
      },
      {
        "time": 190000,
        "value": "0"
      },
      {
        "time": 195000,
        "value": "0"
      },
      {
        "time": 200000,
        "value": "0"
      },
      {
        "time": 205000,
        "value": "0"
      },
      {
        "time": 210000,
        "value": "1"
      },
      {
        "time": 215000,
        "value": "1"
      },
      {
        "time": 220000,
        "value": "0"
      },
      {
        "time": 225000,
        "value": "0"
      },
      {
        "time": 230000,
        "value": "0"
      },
      {
        "time": 235000,
        "value": "0"
      },
      {
        "time": 240000,
        "value": "0"
      },
      {
        "time": 245000,
        "value": "0"
      },
      {
        "time": 250000,
        "value": "0"
      },
      {
        "time": 255000,
        "value": "0"
      },
      {
        "time": 260000,
        "value": "0"
      },
      {
        "time": 265000,
        "value": "0"
      },
      {
        "time": 270000,
        "value": "0"
      },
      {
        "time": 275000,
        "value": "0"
      },
      {
        "time": 280000,
        "value": "0"
      },
      {
        "time": 285000,
        "value": "0"
      },
      {
        "time": 290000,
        "value": "0"
      },
      {
        "time": 295000,
        "value": "0"
      },
      {
        "time": 300000,
        "value": "0"
      },
      {
        "time": 305000,
        "value": "0"
      },
      {
        "time": 310000,
        "value": "0"
      },
      {
        "time": 315000,
        "value": "0"
      }
    ],
    "transitions": 6,
    "frequency": 9523809.523809522,
    "duty_cycle": 9.523809523809524,
    "high_time": 30000,
    "low_time": 285000
  },
  {
    "id": "&",
    "name": "result",
    "type": "reg",
    "width": 32,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "0"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "0"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "0"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "0"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "0"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "0"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "0"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "0"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "0"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "0"
      },
      {
        "time": 105000,
        "value": "0"
      },
      {
        "time": 110000,
        "value": "0"
      },
      {
        "time": 115000,
        "value": "0"
      },
      {
        "time": 120000,
        "value": "0"
      },
      {
        "time": 125000,
        "value": "0"
      },
      {
        "time": 130000,
        "value": "1010"
      },
      {
        "time": 135000,
        "value": "1010"
      },
      {
        "time": 140000,
        "value": "1010"
      },
      {
        "time": 145000,
        "value": "1010"
      },
      {
        "time": 150000,
        "value": "1010"
      },
      {
        "time": 155000,
        "value": "1010"
      },
      {
        "time": 160000,
        "value": "1010"
      },
      {
        "time": 165000,
        "value": "1010"
      },
      {
        "time": 170000,
        "value": "100100"
      },
      {
        "time": 175000,
        "value": "100100"
      },
      {
        "time": 180000,
        "value": "100100"
      },
      {
        "time": 185000,
        "value": "100100"
      },
      {
        "time": 190000,
        "value": "100100"
      },
      {
        "time": 195000,
        "value": "100100"
      },
      {
        "time": 200000,
        "value": "100100"
      },
      {
        "time": 205000,
        "value": "100100"
      },
      {
        "time": 210000,
        "value": "110010"
      },
      {
        "time": 215000,
        "value": "110010"
      },
      {
        "time": 220000,
        "value": "110010"
      },
      {
        "time": 225000,
        "value": "110010"
      },
      {
        "time": 230000,
        "value": "110010"
      },
      {
        "time": 235000,
        "value": "110010"
      },
      {
        "time": 240000,
        "value": "110010"
      },
      {
        "time": 245000,
        "value": "110010"
      },
      {
        "time": 250000,
        "value": "110010"
      },
      {
        "time": 255000,
        "value": "110010"
      },
      {
        "time": 260000,
        "value": "110010"
      },
      {
        "time": 265000,
        "value": "110010"
      },
      {
        "time": 270000,
        "value": "110010"
      },
      {
        "time": 275000,
        "value": "110010"
      },
      {
        "time": 280000,
        "value": "110010"
      },
      {
        "time": 285000,
        "value": "110010"
      },
      {
        "time": 290000,
        "value": "110010"
      },
      {
        "time": 295000,
        "value": "110010"
      },
      {
        "time": 300000,
        "value": "110010"
      },
      {
        "time": 305000,
        "value": "110010"
      },
      {
        "time": 310000,
        "value": "110010"
      },
      {
        "time": 315000,
        "value": "110010"
      }
    ],
    "transitions": 3,
    "frequency": 0,
    "duty_cycle": 0,
    "high_time": 0,
    "low_time": 0
  },
  {
    "id": "'",
    "name": "rst_n",
    "type": "reg",
    "width": 1,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "0"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "0"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "0"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "0"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "0"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "0"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "0"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "0"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "0"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "1"
      },
      {
        "time": 105000,
        "value": "1"
      },
      {
        "time": 110000,
        "value": "1"
      },
      {
        "time": 115000,
        "value": "1"
      },
      {
        "time": 120000,
        "value": "1"
      },
      {
        "time": 125000,
        "value": "1"
      },
      {
        "time": 130000,
        "value": "1"
      },
      {
        "time": 135000,
        "value": "1"
      },
      {
        "time": 140000,
        "value": "1"
      },
      {
        "time": 145000,
        "value": "1"
      },
      {
        "time": 150000,
        "value": "1"
      },
      {
        "time": 155000,
        "value": "1"
      },
      {
        "time": 160000,
        "value": "1"
      },
      {
        "time": 165000,
        "value": "1"
      },
      {
        "time": 170000,
        "value": "1"
      },
      {
        "time": 175000,
        "value": "1"
      },
      {
        "time": 180000,
        "value": "1"
      },
      {
        "time": 185000,
        "value": "1"
      },
      {
        "time": 190000,
        "value": "1"
      },
      {
        "time": 195000,
        "value": "1"
      },
      {
        "time": 200000,
        "value": "1"
      },
      {
        "time": 205000,
        "value": "1"
      },
      {
        "time": 210000,
        "value": "1"
      },
      {
        "time": 215000,
        "value": "1"
      },
      {
        "time": 220000,
        "value": "1"
      },
      {
        "time": 225000,
        "value": "1"
      },
      {
        "time": 230000,
        "value": "1"
      },
      {
        "time": 235000,
        "value": "1"
      },
      {
        "time": 240000,
        "value": "1"
      },
      {
        "time": 245000,
        "value": "1"
      },
      {
        "time": 250000,
        "value": "1"
      },
      {
        "time": 255000,
        "value": "1"
      },
      {
        "time": 260000,
        "value": "1"
      },
      {
        "time": 265000,
        "value": "1"
      },
      {
        "time": 270000,
        "value": "1"
      },
      {
        "time": 275000,
        "value": "1"
      },
      {
        "time": 280000,
        "value": "1"
      },
      {
        "time": 285000,
        "value": "1"
      },
      {
        "time": 290000,
        "value": "1"
      },
      {
        "time": 295000,
        "value": "1"
      },
      {
        "time": 300000,
        "value": "1"
      },
      {
        "time": 305000,
        "value": "1"
      },
      {
        "time": 310000,
        "value": "1"
      },
      {
        "time": 315000,
        "value": "1"
      }
    ],
    "transitions": 1,
    "frequency": 1587301.5873015872,
    "duty_cycle": 69.84126984126983,
    "high_time": 220000,
    "low_time": 95000
  },
  {
    "id": "(",
    "name": "valid",
    "type": "reg",
    "width": 1,
    "values": [
      {
        "time": 0,
        "value": "0"
      },
      {
        "time": 5000,
        "value": "0"
      },
      {
        "time": 10000,
        "value": "0"
      },
      {
        "time": 15000,
        "value": "0"
      },
      {
        "time": 20000,
        "value": "0"
      },
      {
        "time": 25000,
        "value": "0"
      },
      {
        "time": 30000,
        "value": "0"
      },
      {
        "time": 35000,
        "value": "0"
      },
      {
        "time": 40000,
        "value": "0"
      },
      {
        "time": 45000,
        "value": "0"
      },
      {
        "time": 50000,
        "value": "0"
      },
      {
        "time": 55000,
        "value": "0"
      },
      {
        "time": 60000,
        "value": "0"
      },
      {
        "time": 65000,
        "value": "0"
      },
      {
        "time": 70000,
        "value": "0"
      },
      {
        "time": 75000,
        "value": "0"
      },
      {
        "time": 80000,
        "value": "0"
      },
      {
        "time": 85000,
        "value": "0"
      },
      {
        "time": 90000,
        "value": "0"
      },
      {
        "time": 95000,
        "value": "0"
      },
      {
        "time": 100000,
        "value": "0"
      },
      {
        "time": 105000,
        "value": "0"
      },
      {
        "time": 110000,
        "value": "0"
      },
      {
        "time": 115000,
        "value": "0"
      },
      {
        "time": 120000,
        "value": "1"
      },
      {
        "time": 125000,
        "value": "1"
      },
      {
        "time": 130000,
        "value": "0"
      },
      {
        "time": 135000,
        "value": "0"
      },
      {
        "time": 140000,
        "value": "0"
      },
      {
        "time": 145000,
        "value": "0"
      },
      {
        "time": 150000,
        "value": "0"
      },
      {
        "time": 155000,
        "value": "0"
      },
      {
        "time": 160000,
        "value": "1"
      },
      {
        "time": 165000,
        "value": "1"
      },
      {
        "time": 170000,
        "value": "0"
      },
      {
        "time": 175000,
        "value": "0"
      },
      {
        "time": 180000,
        "value": "0"
      },
      {
        "time": 185000,
        "value": "0"
      },
      {
        "time": 190000,
        "value": "0"
      },
      {
        "time": 195000,
        "value": "0"
      },
      {
        "time": 200000,
        "value": "1"
      },
      {
        "time": 205000,
        "value": "1"
      },
      {
        "time": 210000,
        "value": "0"
      },
      {
        "time": 215000,
        "value": "0"
      },
      {
        "time": 220000,
        "value": "0"
      },
      {
        "time": 225000,
        "value": "0"
      },
      {
        "time": 230000,
        "value": "0"
      },
      {
        "time": 235000,
        "value": "0"
      },
      {
        "time": 240000,
        "value": "0"
      },
      {
        "time": 245000,
        "value": "0"
      },
      {
        "time": 250000,
        "value": "0"
      },
      {
        "time": 255000,
        "value": "0"
      },
      {
        "time": 260000,
        "value": "0"
      },
      {
        "time": 265000,
        "value": "0"
      },
      {
        "time": 270000,
        "value": "0"
      },
      {
        "time": 275000,
        "value": "0"
      },
      {
        "time": 280000,
        "value": "0"
      },
      {
        "time": 285000,
        "value": "0"
      },
      {
        "time": 290000,
        "value": "0"
      },
      {
        "time": 295000,
        "value": "0"
      },
      {
        "time": 300000,
        "value": "0"
      },
      {
        "time": 305000,
        "value": "0"
      },
      {
        "time": 310000,
        "value": "0"
      },
      {
        "time": 315000,
        "value": "0"
      }
    ],
    "transitions": 6,
    "frequency": 9523809.523809522,
    "duty_cycle": 9.523809523809524,
    "high_time": 30000,
    "low_time": 285000
  }
];
        const timeRange = [0, 315000];
        
        let selectedSignals = new Set();
        let currentZoom = 1;
        let currentOffset = 0;
        let measurementMode = false;
        let measurementStart = null;
        let measurementEnd = null;
        let cursorPosition = null;
        
        // 画布设置
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const signalHeight = 40;
        const signalSpacing = 50;
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeSignalList();
            setupEventListeners();
            renderWaveforms();
            updateStats();
        });
        
        function initializeSignalList() {
            const signalList = document.getElementById('signalList');
            
            waveformData.forEach((signal, index) => {
                const signalItem = document.createElement('div');
                signalItem.className = 'signal-item';
                signalItem.dataset.signalId = signal.id;
                
                const freqText = signal.frequency > 0 ? `${(signal.frequency/1e6).toFixed(2)} MHz` : 'N/A';
                const dutyText = signal.duty_cycle > 0 ? `${signal.duty_cycle.toFixed(1)}%` : 'N/A';
                
                signalItem.innerHTML = `
                    <div class="signal-name">${signal.name}</div>
                    <div class="signal-info">${signal.type}, ${signal.width} bit</div>
                    <div class="signal-stats">
                        跳变: ${signal.transitions} | 频率: ${freqText}<br>
                        占空比: ${dutyText} | 数据点: ${signal.values.length}
                    </div>
                `;
                
                signalItem.addEventListener('click', () => toggleSignal(signal.id, signalItem));
                signalList.appendChild(signalItem);
            });
        }
        
        function setupEventListeners() {
            // 搜索功能
            document.getElementById('signalSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const signalItems = document.querySelectorAll('.signal-item');
                
                signalItems.forEach(item => {
                    const signalName = item.querySelector('.signal-name').textContent.toLowerCase();
                    item.style.display = signalName.includes(searchTerm) ? 'block' : 'none';
                });
            });
            
            // 缩放控制
            document.getElementById('zoomSlider').addEventListener('input', function() {
                currentZoom = parseFloat(this.value);
                document.getElementById('zoomValue').textContent = currentZoom.toFixed(1) + 'x';
                renderWaveforms();
                updateStats();
            });
            
            // 时间范围控制
            document.getElementById('timeStart').addEventListener('change', () => {
                renderWaveforms();
                updateStats();
            });
            document.getElementById('timeEnd').addEventListener('change', () => {
                renderWaveforms();
                updateStats();
            });
            
            // 画布事件
            canvas.addEventListener('mousemove', handleCanvasMouseMove);
            canvas.addEventListener('click', handleCanvasClick);
            canvas.addEventListener('wheel', handleCanvasWheel);
        }
        
        function toggleSignal(signalId, element) {
            if (selectedSignals.has(signalId)) {
                selectedSignals.delete(signalId);
                element.classList.remove('selected');
            } else {
                selectedSignals.add(signalId);
                element.classList.add('selected');
            }
            
            renderWaveforms();
            updateStats();
        }
        
        function renderWaveforms() {
            const timeStart = parseInt(document.getElementById('timeStart').value) || timeRange[0];
            const timeEnd = parseInt(document.getElementById('timeEnd').value) || timeRange[1];
            
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制背景网格
            drawGrid(timeStart, timeEnd);
            
            // 绘制选中的信号
            let yOffset = 30;
            selectedSignals.forEach(signalId => {
                const signal = waveformData.find(s => s.id === signalId);
                if (signal) {
                    drawSignalWaveform(signal, yOffset, timeStart, timeEnd);
                    yOffset += signalSpacing;
                }
            });
            
            // 绘制测量线
            if (measurementStart !== null) {
                drawMeasurementLine(measurementStart, 'green');
            }
            if (measurementEnd !== null) {
                drawMeasurementLine(measurementEnd, 'red');
            }
            
            // 绘制光标
            if (cursorPosition !== null) {
                drawCursor(cursorPosition);
            }
        }
        
        function drawGrid(timeStart, timeEnd) {
            const timeDuration = timeEnd - timeStart;
            const gridLines = 20;
            
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            
            // 垂直网格线
            for (let i = 0; i <= gridLines; i++) {
                const x = (i / gridLines) * canvas.width;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
                
                // 时间标签
                const time = timeStart + (timeDuration * i / gridLines);
                ctx.fillStyle = '#6c757d';
                ctx.font = '10px Arial';
                ctx.fillText(time.toLocaleString() + 'ps', x + 2, 15);
            }
            
            // 水平网格线
            const signalCount = selectedSignals.size;
            for (let i = 0; i <= signalCount; i++) {
                const y = 30 + i * signalSpacing;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        function drawSignalWaveform(signal, yOffset, timeStart, timeEnd) {
            if (signal.values.length === 0) return;
            
            // 绘制信号名称
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 12px Arial';
            ctx.fillText(signal.name, 5, yOffset - 10);
            
            if (signal.width === 1) {
                drawDigitalSignal(signal, yOffset, timeStart, timeEnd);
            } else {
                drawBusSignal(signal, yOffset, timeStart, timeEnd);
            }
        }
        
        function drawDigitalSignal(signal, yOffset, timeStart, timeEnd) {
            ctx.strokeStyle = '#007bff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            let lastValue = '0';
            let lastX = 0;
            
            signal.values.forEach((point, index) => {
                if (point.time < timeStart || point.time > timeEnd) return;
                
                const x = ((point.time - timeStart) / (timeEnd - timeStart)) * canvas.width;
                const y = point.value === '1' ? yOffset - 15 : yOffset + 15;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    if (point.value !== lastValue) {
                        ctx.lineTo(x, lastValue === '1' ? yOffset - 15 : yOffset + 15);
                        ctx.lineTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                lastValue = point.value;
                lastX = x;
            });
            
            ctx.stroke();
            
            // 绘制高低电平标签
            ctx.fillStyle = '#495057';
            ctx.font = '10px Arial';
            ctx.fillText('1', 10, yOffset - 20);
            ctx.fillText('0', 10, yOffset + 20);
        }
        
        function drawBusSignal(signal, yOffset, timeStart, timeEnd) {
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 2;
            
            signal.values.forEach((point, index) => {
                if (point.time < timeStart || point.time > timeEnd) return;
                
                const x = ((point.time - timeStart) / (timeEnd - timeStart)) * canvas.width;
                const nextPoint = signal.values[index + 1];
                const width = nextPoint ? 
                    ((nextPoint.time - point.time) / (timeEnd - timeStart)) * canvas.width : 
                    100;
                
                // 绘制总线波形
                ctx.beginPath();
                ctx.moveTo(x, yOffset - 10);
                ctx.lineTo(x + 8, yOffset - 15);
                ctx.lineTo(x + width - 8, yOffset - 15);
                ctx.lineTo(x + width, yOffset - 10);
                ctx.lineTo(x + width - 8, yOffset + 15);
                ctx.lineTo(x + 8, yOffset + 15);
                ctx.closePath();
                ctx.stroke();
                
                // 绘制数值
                ctx.fillStyle = '#495057';
                ctx.font = '9px Courier New';
                const value = point.value.length > 6 ? point.value.substring(0, 6) + '...' : point.value;
                ctx.fillText(value, x + 10, yOffset + 3);
            });
        }
        
        function drawMeasurementLine(time, color) {
            const timeStart = parseInt(document.getElementById('timeStart').value) || timeRange[0];
            const timeEnd = parseInt(document.getElementById('timeEnd').value) || timeRange[1];
            const x = ((time - timeStart) / (timeEnd - timeStart)) * canvas.width;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        function drawCursor(time) {
            const timeStart = parseInt(document.getElementById('timeStart').value) || timeRange[0];
            const timeEnd = parseInt(document.getElementById('timeEnd').value) || timeRange[1];
            const x = ((time - timeStart) / (timeEnd - timeStart)) * canvas.width;
            
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.stroke();
        }
        
        function handleCanvasMouseMove(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            
            const timeStart = parseInt(document.getElementById('timeStart').value) || timeRange[0];
            const timeEnd = parseInt(document.getElementById('timeEnd').value) || timeRange[1];
            const time = timeStart + (x / canvas.width) * (timeEnd - timeStart);
            
            cursorPosition = time;
            document.getElementById('cursorTime').textContent = Math.round(time).toLocaleString();
            
            renderWaveforms();
        }
        
        function handleCanvasClick(event) {
            if (!measurementMode) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            
            const timeStart = parseInt(document.getElementById('timeStart').value) || timeRange[0];
            const timeEnd = parseInt(document.getElementById('timeEnd').value) || timeRange[1];
            const time = timeStart + (x / canvas.width) * (timeEnd - timeStart);
            
            if (measurementStart === null) {
                measurementStart = time;
            } else if (measurementEnd === null) {
                measurementEnd = time;
                const delta = Math.abs(measurementEnd - measurementStart);
                document.getElementById('measurementDelta').textContent = Math.round(delta).toLocaleString();
                
                // 显示详细测量信息
                showMeasurementInfo(measurementStart, measurementEnd);
            } else {
                // 重新开始测量
                measurementStart = time;
                measurementEnd = null;
                document.getElementById('measurementDelta').textContent = '-';
            }
            
            renderWaveforms();
        }
        
        function handleCanvasWheel(event) {
            event.preventDefault();
            const delta = event.deltaY > 0 ? 0.9 : 1.1;
            currentZoom = Math.max(0.1, Math.min(20, currentZoom * delta));
            
            document.getElementById('zoomSlider').value = currentZoom;
            document.getElementById('zoomValue').textContent = currentZoom.toFixed(1) + 'x';
            renderWaveforms();
            updateStats();
        }
        
        function showMeasurementInfo(start, end) {
            const panel = document.getElementById('measurementPanel');
            const info = document.getElementById('measurementInfo');
            
            const delta = Math.abs(end - start);
            const frequency = delta > 0 ? 1e12 / (2 * delta) : 0;
            
            info.innerHTML = `
                <h4>📏 测量结果</h4>
                <div>起始时间: ${Math.round(start).toLocaleString()} ps</div>
                <div>结束时间: ${Math.round(end).toLocaleString()} ps</div>
                <div>时间间隔: ${Math.round(delta).toLocaleString()} ps</div>
                <div>等效频率: ${(frequency/1e6).toFixed(2)} MHz</div>
                <div>等效周期: ${(delta*2/1000).toFixed(2)} ns</div>
            `;
            
            panel.style.display = 'block';
        }
        
        function updateStats() {
            document.getElementById('selectedSignals').textContent = selectedSignals.size;
            
            const timeStart = parseInt(document.getElementById('timeStart').value) || timeRange[0];
            const timeEnd = parseInt(document.getElementById('timeEnd').value) || timeRange[1];
            document.getElementById('visibleTime').textContent = Math.round(timeEnd - timeStart).toLocaleString();
        }
        
        function resetView() {
            currentZoom = 1;
            currentOffset = 0;
            measurementStart = null;
            measurementEnd = null;
            measurementMode = false;
            
            document.getElementById('timeStart').value = timeRange[0];
            document.getElementById('timeEnd').value = timeRange[1];
            document.getElementById('zoomSlider').value = 1;
            document.getElementById('zoomValue').textContent = '1.0x';
            document.getElementById('measurementDelta').textContent = '-';
            document.getElementById('measurementPanel').style.display = 'none';
            
            renderWaveforms();
            updateStats();
        }
        
        function fitToWindow() {
            canvas.width = canvas.parentElement.clientWidth - 40;
            renderWaveforms();
        }
        
        function measureMode() {
            measurementMode = !measurementMode;
            const btn = event.target;
            
            if (measurementMode) {
                btn.textContent = '退出测量';
                btn.className = 'btn danger';
                canvas.style.cursor = 'crosshair';
            } else {
                btn.textContent = '测量模式';
                btn.className = 'btn success';
                canvas.style.cursor = 'default';
                measurementStart = null;
                measurementEnd = null;
                document.getElementById('measurementPanel').style.display = 'none';
                renderWaveforms();
            }
        }
        
        function exportData() {
            const exportData = {
                file: 'simple_mac_test.vcd',
                signals: Array.from(selectedSignals).map(id => {
                    const signal = waveformData.find(s => s.id === id);
                    return {
                        name: signal.name,
                        type: signal.type,
                        width: signal.width,
                        values: signal.values,
                        stats: {
                            transitions: signal.transitions,
                            frequency: signal.frequency,
                            duty_cycle: signal.duty_cycle
                        }
                    };
                }),
                timeRange: [
                    parseInt(document.getElementById('timeStart').value),
                    parseInt(document.getElementById('timeEnd').value)
                ],
                measurement: measurementStart !== null && measurementEnd !== null ? {
                    start: measurementStart,
                    end: measurementEnd,
                    delta: Math.abs(measurementEnd - measurementStart)
                } : null,
                exportTime: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'simple_mac_test_waveform_data.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // 自动选择前几个信号进行显示
        setTimeout(() => {
            const firstFewSignals = waveformData.slice(0, Math.min(5, waveformData.length));
            firstFewSignals.forEach(signal => {
                const element = document.querySelector(`[data-signal-id="${signal.id}"]`);
                if (element) {
                    toggleSignal(signal.id, element);
                }
            });
        }, 100);
    </script>
</body>
</html>