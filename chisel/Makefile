# RISC-V AI Accelerator Chisel Project Makefile
# è®¾ç½®Javaç¯å¢ƒ
JAVA_HOME := /Library/Java/JavaVirtualMachines/jdk-11.0.16.jdk/Contents/Home
export JAVA_HOME
export PATH := $(JAVA_HOME)/bin:$(PATH)

# SBTå‘½ä»¤å‰ç¼€
SBT := sbt

# é»˜è®¤ç›®æ ‡
.PHONY: all test clean compile help generate

all: compile test

# ç¼–è¯‘é¡¹ç›®
compile:
	@echo "ğŸ“¦ ç¼–è¯‘Chiselé¡¹ç›®..."
	$(SBT) compile

# ç¼–è¯‘æµ‹è¯•ä»£ç 
compile-test:
	@echo "ğŸ“¦ ç¼–è¯‘æµ‹è¯•ä»£ç ..."
	$(SBT) Test/compile

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•..."
	$(SBT) test

# è¿è¡Œ SimpleEdgeAiSoC æµ‹è¯•
test-soc:
	@echo "ğŸ§ª è¿è¡Œ SimpleEdgeAiSoC æµ‹è¯•..."
	$(SBT) 'testOnly riscv.ai.SimpleEdgeAiSoCTest'

# è¿è¡Œ PicoRV32 æ ¸å¿ƒæµ‹è¯•
test-picorv32:
	@echo "ğŸ§ª è¿è¡Œ PicoRV32 æ ¸å¿ƒæµ‹è¯•..."
	$(SBT) 'testOnly riscv.ai.PicoRV32CoreTest'

# è¿è¡Œ BitNet åŠ é€Ÿå™¨æµ‹è¯•
test-bitnet:
	@echo "ğŸ§ª è¿è¡Œ BitNet åŠ é€Ÿå™¨è°ƒè¯•æµ‹è¯•..."
	$(SBT) 'testOnly riscv.ai.BitNetAccelDebugTest'

# è¿è¡Œ Compact åŠ é€Ÿå™¨æµ‹è¯•
test-compact:
	@echo "ğŸ§ª è¿è¡Œ Compact åŠ é€Ÿå™¨è°ƒè¯•æµ‹è¯•..."
	$(SBT) 'testOnly riscv.ai.SimpleCompactAccelDebugTest'

# è¿è¡Œ RISC-V æŒ‡ä»¤æµ‹è¯•
test-riscv:
	@echo "ğŸ§ª è¿è¡Œ RISC-V æŒ‡ä»¤æµ‹è¯•..."
	$(SBT) 'testOnly riscv.ai.SimpleRiscvInstructionTests'

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
test-verbose:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•ï¼ˆè¯¦ç»†è¾“å‡ºï¼‰..."
	$(SBT) 'set Test / testOptions += Tests.Argument("-oD")' test

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	$(SBT) clean
	@echo "ğŸ§¹ åˆ é™¤æµ‹è¯•è¿è¡Œç›®å½•..."
	rm -rf test_run_dir
	@echo "ğŸ§¹ åˆ é™¤ç”Ÿæˆçš„æ–‡ä»¶..."
	rm -rf generated

# ç”Ÿæˆ SimpleEdgeAiSoC Verilog
generate:
	@echo "ğŸ”§ ç”Ÿæˆ SimpleEdgeAiSoC SystemVerilog..."
	$(SBT) 'runMain riscv.ai.SimpleEdgeAiSoCMain'

# ç”Ÿæˆæ‰€æœ‰ç‰ˆæœ¬çš„ Verilog
generate-all:
	@echo "ğŸ”§ ç”Ÿæˆæ‰€æœ‰ç‰ˆæœ¬çš„ SystemVerilog..."
	$(SBT) 'runMain riscv.ai.VerilogGenerator'

# å¿«é€Ÿæµ‹è¯•ï¼ˆä»…è¿è¡Œ SoC æµ‹è¯•ï¼‰
quick-test: compile test-soc

# å®Œæ•´æµç¨‹
full: compile test generate
	@echo "âœ… å®Œæ•´æµç¨‹å®Œæˆï¼"

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
help:
	@echo "RISC-V AI Accelerator - å¯ç”¨çš„ make ç›®æ ‡ï¼š"
	@echo ""
	@echo "ğŸ“¦ ç¼–è¯‘ç›¸å…³ï¼š"
	@echo "  compile          - ç¼–è¯‘é¡¹ç›®"
	@echo "  compile-test     - ç¼–è¯‘æµ‹è¯•ä»£ç "
	@echo ""
	@echo "ğŸ§ª æµ‹è¯•ç›¸å…³ï¼š"
	@echo "  test             - è¿è¡Œæ‰€æœ‰æµ‹è¯•"
	@echo "  test-soc         - è¿è¡Œ SimpleEdgeAiSoC æµ‹è¯•"
	@echo "  test-picorv32    - è¿è¡Œ PicoRV32 æ ¸å¿ƒæµ‹è¯•"
	@echo "  test-bitnet      - è¿è¡Œ BitNet åŠ é€Ÿå™¨æµ‹è¯•"
	@echo "  test-compact     - è¿è¡Œ Compact åŠ é€Ÿå™¨æµ‹è¯•"
	@echo "  test-riscv       - è¿è¡Œ RISC-V æŒ‡ä»¤æµ‹è¯•"
	@echo "  test-verbose     - è¿è¡Œæµ‹è¯•ï¼ˆè¯¦ç»†è¾“å‡ºï¼‰"
	@echo "  quick-test       - å¿«é€Ÿæµ‹è¯•ï¼ˆä»… SoCï¼‰"
	@echo ""
	@echo "ğŸ”§ ç”Ÿæˆç›¸å…³ï¼š"
	@echo "  generate         - ç”Ÿæˆ SimpleEdgeAiSoC SystemVerilog"
	@echo "  generate-all     - ç”Ÿæˆæ‰€æœ‰ç‰ˆæœ¬çš„ SystemVerilog"
	@echo ""
	@echo "ğŸ§¹ æ¸…ç†ç›¸å…³ï¼š"
	@echo "  clean            - æ¸…ç†æ‰€æœ‰æ„å»ºæ–‡ä»¶"
	@echo ""
	@echo "ğŸš€ å·¥ä½œæµï¼š"
	@echo "  all              - ç¼–è¯‘å¹¶è¿è¡Œæ‰€æœ‰æµ‹è¯•"
	@echo "  full             - å®Œæ•´æµç¨‹ï¼ˆç¼–è¯‘+æµ‹è¯•+ç”Ÿæˆï¼‰"
	@echo "  help             - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
	@echo ""
	@echo "ğŸ’¡ ç¤ºä¾‹ï¼š"
	@echo "  make quick-test  - å¿«é€ŸéªŒè¯ SoC åŠŸèƒ½"
	@echo "  make full        - å®Œæ•´çš„å¼€å‘æµç¨‹"
	@echo "  make generate    - ä»…ç”Ÿæˆ Verilog æ–‡ä»¶"
	@echo ""
	@echo "ğŸ”§ ç¯å¢ƒå˜é‡ï¼š"
	@echo "  JAVA_HOME=$(JAVA_HOME)"